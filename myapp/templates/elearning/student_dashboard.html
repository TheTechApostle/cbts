{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ student.full_name }} - Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background-color: #f9fafb;
      font-family: "Inter", sans-serif;
    }

    .hero-title {
      font-size: 2.8rem;
      font-weight: 800;
      line-height: 1.2;
      color: #111827;
    }

    .hero-subtitle {
      max-width: 650px;
      font-size: 1rem;
      color: #6b7280;
      line-height: 1.7;
    }

    .search-box {
      max-width: 480px;
      position: relative;
    }
    .search-box input {
      padding-left: 45px;
      border-radius: 50px;
      height: 48px;
      font-size: 15px;
      border: 1px solid #d1d5db;
      background-color: #f3f4f6;
    }
    .search-icon {
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
      color: #6b7280;
    }

    .pill {
      padding: 8px 18px;
      font-size: 14px;
      background: #f3f4f6;
      border-radius: 50px;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      transition: 0.2s;
    }

    .pill:hover {
      background-color: #e5e7eb;
    }

    .btn-start {
      padding: 10px 28px;
      font-size: 14px;
      border-radius: 50px;
      font-weight: 600;
      background: #0d6efd;
      color: white;
    }

    .metric-card {
      background: white;
      border: 1px solid #e5e7eb;
      padding: 28px;
      border-radius: 20px;
      transition: 0.3s;
    }
    .metric-card:hover {
      box-shadow: 0 4px 18px rgba(0,0,0,0.06);
    }

    .metric-card h2 {
      font-size: 2.3rem;
      color: #0d6efd;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .course-card {
      background: white;
      padding: 28px;
      border-radius: 20px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      transition: 0.3s;
    }
    .course-card:hover {
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }

    .btn-watch {
      background: #0d6efd;
      color: white;
      border-radius: 50px;
      font-size: 12px;
      padding: 6px 14px;
    }
  </style>
</head>

<body>

<!-- HEADER -->
{% include "header.html" %}

<div class="d-flex min-vh-100">

  <!-- SIDEBAR -->
  <aside class="d-none d-md-block bg-white border-end" style="width: 260px;">
    {% include "elearning/sidebar.html" %}
  </aside>

  <!-- MAIN -->
  <main class="flex-grow-1 p-4 p-md-5">

    <!-- WELCOME -->
    <div class="mb-4 justify-content-center">
      <h2 class="fw-bold text-dark text-right">Hello, {{ student.full_name }}!</h2>
      
      </div>

    <!-- HERO -->
    <!-- Hero Section -->


<!-- YouTube Search -->
<section class="mb-5 justify-content-center text-center">
  <p class="text-center">
        <small class="text-secondary" style="float:center">Welcome back â€” track your progress and continue your learning journey.</small>
      </p>
  <h2 class="fw-bold mb-1">Choose Your Learning Mode</h2>
<div class="mb-3">
  <small>Select whether you want to search YouTube or generate AI content and the right form will appear below.</small>
</div>

<!-- Toggle Buttons -->
{% comment %} <div class="btn-group mb-4" role="group">
  <button class="btn btn-outline-primary" id="youtubeBtn">Search YouTube</button>
  <button class="btn btn-outline-danger" id="aiBtn">AI Generate</button>
</div> {% endcomment %}

<!-- YouTube Form -->
<!-- Toggle Buttons -->
<div class="btn-group mb-4 text-left" role="group">
  <a href="?mode=youtube" class="btn btn-outline-primary {% if request.GET.mode == 'youtube' %}active{% endif %}">
    Search YouTube
  </a>
  <a href="?mode=ai" class="btn btn-outline-danger {% if request.GET.mode == 'ai' %}active{% endif %}">
    AI Generate
  </a>
</div>

<!-- YouTube Form -->
{% if request.GET.mode == "youtube" %}
<div id="youtubeForm" class="mb-5 justify-content-center">
  <h5 class="fw-bold mb-3 text-left">Search YouTube</h5>
  <form method="get" class="d-flex gap-2 mb-4">
    <input type="hidden" name="mode" value="youtube">
    <input type="text" name="q" class="form-control" placeholder="Type a topic..." value="{{ query }}">
    <button type="submit" class="btn btn-primary">Search</button>
  </form>

  {% if video_id %}
    <h4 class="mb-3">Result for "{{ query }}"</h4>
    <div class="ratio ratio-16x9">
      <div id="player"></div>
    </div>
    <script>
      (function() {
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);
      })();

      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          videoId: '{{ video_id }}',
          playerVars: { rel: 0, modestbranding: 1 },
          events: {
            'onReady': function(event) { event.target.playVideo(); }
          }
        });
      }
    </script>
  {% endif %}
</div>
{% endif %}

<!-- AI Generate Form -->
{% if request.GET.mode == "ai" %}
<div id="aiForm" class="mb-5">
  <h3 class="fw-bold mb-3">AI Generate</h3>
  <form method="post" class="d-flex gap-2 mb-4">
    {% csrf_token %}
    <input type="hidden" name="mode" value="ai">
    <input type="text" name="prompt" class="form-control" placeholder="Enter a topic for AI generation">
    <button type="submit" class="btn btn-danger">Generate</button>
  </form>

  {% if ai_output %}
    <div class="card p-3 shadow-sm">
      <h5 class="fw-bold">AI Result</h5>
      <p>{{ ai_output }}</p>
    </div>
  {% endif %}
</div>
{% endif %}


<!-- Toggle Script -->
<script>
  const youtubeBtn = document.getElementById("youtubeBtn");
  const aiBtn = document.getElementById("aiBtn");
  const youtubeForm = document.getElementById("youtubeForm");
  const aiForm = document.getElementById("aiForm");

  youtubeBtn.addEventListener("click", () => {
    youtubeForm.style.display = "block";
    aiForm.style.display = "none";
  });

  aiBtn.addEventListener("click", () => {
    aiForm.style.display = "block";
    youtubeForm.style.display = "none";
  });
</script>


    <!-- METRICS -->
   <div class="row g-3 mb-4">
    <div class="col-md-4">
    <div class="metric-card">
      <h2>{{ courses.count }}</h2>
      <span class="text-secondary">Courses Registered</span>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-card">
      <h2>{{ total_lectures }}</h2>
      <span class="text-secondary">Lectures Available</span>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-card">
      <h2>{{ total_votes }}</h2>
      <span class="text-secondary">Votes Cast</span>
    </div>
  </div>
</div>


    <!-- COURSES -->
    <h2 class="fw-bold text-dark mb-4">My Courses</h2>
<div class="row g-3"> <!-- reduced gap -->
  {% for course in courses %}
    {% if course.lectures.exists %}
      <div class="col-md-6">
        <div class="course-card">
          <h4 class="fw-bold mb-1">{{ course.title }}</h4>
          <p class="text-secondary small">{{ course.description|truncatechars:140 }}</p>

          <canvas id="progressChart{{ course.id }}" class="my-2"></canvas>

          <ul class="list-group list-group-flush">
            {% for lecture in course.lectures.all %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ lecture.title }}
                <a href="{% url 'lecture_student_view' lecture.id %}" class="btn-watch">
                  <i class="fa fa-play"></i> Watch
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}
  {% empty %}
    <div class="alert alert-warning">No courses registered yet.</div>
  {% endfor %}
</div>


  </main>
</div>

{% include "footer.html" %}

<!-- CHART LOADER -->
<script>
{% for course in courses %}
var ctx{{ course.id }} = document.getElementById("progressChart{{ course.id }}");

new Chart(ctx{{ course.id }}, {
  type: "doughnut",
  data: {
    labels: ["Completed", "Remaining"],
    datasets: [{
      data: [{{ course.completed_lectures }}, {{ course.lectures.count|add:"-course.completed_lectures" }}],
      backgroundColor: ["#0d6efd", "#e5e7eb"],
      borderWidth: 0
    }]
  },
  options: {
    cutout: "70%",
    plugins: { legend: { display: false }}
  }
});
{% endfor %}
</script>
<style>
  .metric-card {
  background: #fff;
  padding: 1rem;              /* reduced padding */
  border-radius: 10px;        /* slimmer corners */
  border: 1px solid #f0f0f0;
  box-shadow: 0 1px 4px rgba(0,0,0,.05);
  text-align: center;
}

.metric-card h2 {
  font-weight: 700;
  color: #2563eb;
  font-size: 1.5rem;          /* smaller font size */
  margin-bottom: .25rem;
}

.metric-card span {
  color: #6b7280;
  font-size: 0.85rem;         /* slimmer text */
}
.course-card {
  background: #fff;
  padding: 1rem;              /* reduced padding */
  border-radius: 10px;        /* slimmer corners */
  border: 1px solid #eee;
  box-shadow: 0 2px 6px rgba(0,0,0,.05);
  transition: .2s ease;
}

.course-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}

.course-card h4 {
  font-size: 1rem;            /* smaller title */
  font-weight: 600;
  margin-bottom: .25rem;
  color: #111827;
}

.course-card p {
  font-size: .85rem;          /* slimmer description */
  margin-bottom: .75rem;
}

.course-card canvas {
  max-height: 120px;          /* smaller chart */
  margin-bottom: .75rem;
}

.course-card .list-group-item {
  font-size: .85rem;          /* slimmer lecture text */
  padding: .4rem .75rem;      /* reduced padding */
}

.btn-watch {
  background: #2563eb;
  color: #fff;
  border-radius: 999px;
  padding: .25rem .75rem;     /* slimmer button */
  font-size: .75rem;
  font-weight: 600;
}
.btn-watch i { margin-right: 4px; }

</style>

</body>
</html>
